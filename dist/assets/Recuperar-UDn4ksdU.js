import{r,u as L,b as k,B as j,j as e}from"./index-Bw8vxug1.js";import{u as D}from"./index.esm-v9O0ghl2.js";import{d as R,V as z,a as M,e as B}from"./Inputs-BnIsm3X-.js";import{a as v}from"./Buttons-CLO9Hq2r.js";function $({onTimeout:d,resetTrigger:g,setTimeLeftProp:i}){const[x,f]=r.useState(60),h=r.useRef(60);r.useEffect(()=>{const o=localStorage.getItem("timeLeft"),s=localStorage.getItem("timestamp");if(o!==null&&s!==null){const n=Math.floor((Date.now()-parseInt(s))/1e3),c=Math.max(parseInt(o)-n,0);f(c),setTimeout(()=>i(c),0)}const l=setInterval(()=>{f(n=>{const c=Math.max(n-1,0);return localStorage.setItem("timeLeft",c),localStorage.setItem("timestamp",Date.now().toString()),setTimeout(()=>i(c),0),c})},1e3);return()=>clearInterval(l)},[i]),r.useEffect(()=>{g&&(f(h.current),localStorage.setItem("timeLeft",h.current),localStorage.setItem("timestamp",Date.now().toString()),setTimeout(()=>i(h.current),0))},[g,i]),r.useEffect(()=>{x===0&&d()},[x,d]);const u=o=>{const s=Math.floor(o/60),l=o%60;return`${s}:${l<10?"0":""}${l}`};return e.jsx("span",{children:u(x)})}function H(){const[d,g]=r.useState(0),[i,x]=r.useState(!1),[f,h]=r.useState(60),{register:u,handleSubmit:o,formState:{errors:s},setValue:l,watch:n,trigger:c}=D(),{sendCodeEmail:p,recoverPassword:I}=L(),S=k();r.useEffect(()=>{const t=localStorage.getItem("currentView");t!==null&&g(parseInt(t))},[]);const w=()=>{g(t=>{const a=(t+1)%3;return localStorage.setItem("currentView",a),a})},N=t=>{t.preventDefault(),g(a=>{const m=(a-1+3)%3;return localStorage.setItem("currentView",m),m}),localStorage.removeItem("correo"),localStorage.removeItem("codigo"),localStorage.removeItem("timestamp"),localStorage.removeItem("timeLeft"),window.location.reload()},b=async t=>{t.preventDefault();try{x(m=>!m),localStorage.removeItem("codigo");const a=await p(localStorage.getItem("correo"));localStorage.setItem("codigo",a.data[0])}catch(a){console.log(a)}},y=r.useCallback(t=>{h(t)},[]),V=()=>{console.log("El tiempo ha terminado"),localStorage.removeItem("codigo")},E=o(async t=>{console.log(t);const a=await p(t.correo);a?(localStorage.setItem("codigo",a.data[0]),localStorage.setItem("correo",t.correo),w()):j.error("No se pudo enviar el correo")}),T=o(t=>{const a=localStorage.getItem("codigo");t.code===a?(localStorage.removeItem("codigo"),localStorage.removeItem("timeLeft"),localStorage.removeItem("timestamp"),w()):a===null?j.error("Codigo caducado"):j.error("El código ingresado no coincide")}),C=o(async t=>{const a=localStorage.getItem("correo");try{await I(a,t.pass)&&(localStorage.removeItem("correo"),localStorage.removeItem("currentView"),S("/"))}catch(m){console.log(m)}});return e.jsxs(e.Fragment,{children:[d===0&&e.jsx("div",{className:"min-h-screen",children:e.jsx("div",{className:"flex justify-center items-center min-h-screen",children:e.jsx("div",{className:"w-full md:w-96",children:e.jsxs("div",{className:"bg-zinc-800 p-4 shadow-white rounded-md",children:[e.jsx("div",{className:"min-h-20 flex items-center justify-center mb-6",children:e.jsx("img",{src:"/img/emblema.png",alt:"Logo de la Empresa",className:"w-full max-w-full max-h-full"})}),e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"mb-1 text-magenta text-gray-200 font-bold",children:"Recuperación de contraseña"}),e.jsx("p",{className:"text-gray-400 mb-4",children:"Introduce tu correo electrónico y te enviaremos un código de verificación."})]}),e.jsxs("form",{onSubmit:E,className:"space-y-5",children:[e.jsx(R,{title:"Correo",name:"correo",min:"10",max:"100",onChange:t=>console.log(t.target.value),err:s,method:u,look:n}),e.jsx(v,{text:"Enviar código"})]})]})})})}),d===1&&e.jsx("div",{className:"min-h-screen",children:e.jsx("div",{className:"flex justify-center items-center min-h-screen",children:e.jsx("div",{className:"w-full md:w-96",children:e.jsxs("div",{className:"bg-zinc-800 p-4 shadow-white rounded-md",children:[e.jsx("div",{className:"min-h-20 flex items-center justify-center mb-6",children:e.jsx("img",{src:"/img/emblema.png",alt:"Logo de la Empresa",className:"w-full max-w-full max-h-full"})}),e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"mb-1 text-magenta text-gray-200 font-bold",children:"Introduce el código"}),e.jsxs("p",{className:"text-gray-400 mb-4",children:["Introduce el código de verificación que te ha llegado al correo ",localStorage.getItem("correo")]})]}),e.jsxs("form",{onSubmit:T,className:"space-y-5",children:[e.jsx(z,{title:"Código de verificación",name:"code",min:"6",max:"6",pattern:/\D/,err:s,method:u,val:l}),e.jsxs("p",{className:"text-center",children:["Volver a enviar el código: ",e.jsx($,{onTimeout:V,resetTrigger:i,setTimeLeftProp:y})]}),e.jsx(v,{width:"w-full",text:"Enviar código nuevamente",click:b,disabled:f>0}),e.jsx(v,{text:"Cambiar correo",click:N}),e.jsx(v,{text:"Verificar código"})]})]})})})}),d===2&&e.jsx("div",{className:"min-h-screen",children:e.jsx("div",{className:"flex justify-center items-center min-h-screen",children:e.jsx("div",{className:"w-full md:w-96",children:e.jsxs("div",{className:"bg-zinc-800 p-4 shadow-white rounded-md",children:[e.jsx("div",{className:"min-h-20 flex items-center justify-center mb-6",children:e.jsx("img",{src:"/img/emblema.png",alt:"Logo de la Empresa",className:"w-full max-w-full max-h-full"})}),e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"mb-1 text-magenta text-gray-200 font-bold",children:"Cambia tu contraseña"}),e.jsx("p",{className:"text-gray-400 mb-4",children:"No compartas tu contraseña con nadie más."})]}),e.jsxs("form",{onSubmit:C,className:"space-y-5",children:[e.jsx(M,{title:"Contraseña",name:"pass",min:"8",max:"16",err:s,method:u,look:n,val:l,triger:c}),e.jsx(B,{title:"Confirmar contraseña",name:"passConf",min:"8",max:"16",err:s,method:u,look:n,val:l,triger:c}),e.jsx(v,{text:"Enviar contraseña"})]})]})})})})]})}export{H as default};
