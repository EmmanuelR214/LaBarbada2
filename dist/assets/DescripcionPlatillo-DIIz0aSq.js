import{u as re,f as ae,b as oe,r as l,k as te,l as le,j as r,i as se,m as ce,B as s,D as ie}from"./index-Bw8vxug1.js";import{C as _}from"./Inputs-BnIsm3X-.js";import{c as S,d as ne,a as P}from"./Buttons-CLO9Hq2r.js";function ge(){const{isAuthenticade:j,user:de}=re(),i=localStorage.getItem("id"),{InsertarCarrito:n}=ae(),d=oe(),[p,T]=l.useState(1),[D,A]=l.useState(0),[I,$]=l.useState(0),[B,O]=l.useState(null),[E,k]=l.useState(null),[m,b]=l.useState(""),[u,N]=l.useState(""),[f,G]=l.useState([]),[w,R]=l.useState([]),[g,U]=l.useState([]),[h,z]=l.useState([]),[F,H]=l.useState([]),[L,Q]=l.useState([]),y=localStorage.getItem("platillo"),v=B*p,V=(v+D+I).toFixed(2),{data:t,isLoading:q}=te(["platillo",y],async()=>{const a=(await ie(y)).data;if(!a)throw new Error("Error al cargar los detalles del platillo");return a});l.useEffect(()=>{(async()=>{try{if(t&&t.length>0){const a=t[0].id_platillo,o=m.value,x=u.value;if(U(t[0].tamaños.split(",")),z(t[0].presentaciones.split(",")),H(t[1].filter(c=>c.tipo==="guarnicion")),Q(t[1].filter(c=>c.tipo==="acompañamiento")),o!==void 0||x!==void 0){let c=await ce(a,o,x);c=c.data,O(c[0].precio),k(c[0].id_relacion)}}}catch(a){console.log(a),s.error("Error al cargar los detalles del platillo")}})()},[t,m.value,u.value]),l.useEffect(()=>{t&&t.length>0&&u===""&&m===""&&J()},[t,u,m]);const J=async()=>{try{let e=await le(t[0].id_platillo,t[0].precio);e=e.data,N({value:e[0].presentacion,label:e[0].presentacion}),b({value:e[0].tamaño,label:e[0].tamaño})}catch(e){console.log(e)}},K=e=>T(e),M=e=>b(e),W=e=>N(e),C=e=>e.map(o=>parseFloat(o.precio)).reduce((o,x)=>o+x,0),X=e=>{const a=C(e);A(a),G(e)},Y=e=>{const a=C(e);$(a),R(e)},Z=async()=>{try{if(j)await(async()=>{for(const a of f)try{if(!(await n(a.value,i,1,a.precio)).includes("agregado"))throw new Error("Error al agregar guarnición al carrito")}catch(o){throw console.error("Error al agregar guarnición:",o),s.error("Error al agregar guarnición al carrito"),o}for(const a of w)try{if(!(await n(a.value,i,1,a.precio)).includes("agregado"))throw new Error("Error al agregar acompañamiento al carrito")}catch(o){throw console.error("Error al agregar acompañamiento:",o),s.error("Error al agregar acompañamiento al carrito"),o}try{if(!(await n(E,i,p,v)).includes("agregado"))throw new Error("Error al agregar platillo al carrito")}catch(a){throw console.error("Error al agregar platillo:",a),s.error("Error al agregar platillo al carrito"),a}})(),d("/payment");else{s.error("Necesitas Iniciar sesión para poder hacer una compra"),setTimeout(()=>{d("/login")},2e3);return}}catch(e){console.log(e)}},ee=async()=>{try{if(!j){s.error("Necesitas iniciar sesión para poder agregar al carrito"),setTimeout(()=>{d("/login")},2e3);return}await(async()=>{for(const a of f)try{if(!(await n(a.value,i,1,a.precio)).includes("agregado"))throw new Error("Error al agregar guarnición al carrito")}catch(o){throw console.error("Error al agregar guarnición:",o),s.error("Error al agregar guarnición al carrito"),o}for(const a of w)try{if(!(await n(a.value,i,1,a.precio)).includes("agregado"))throw new Error("Error al agregar acompañamiento al carrito")}catch(o){throw console.error("Error al agregar acompañamiento:",o),s.error("Error al agregar acompañamiento al carrito"),o}try{const a=await n(E,i,p,v);if(console.log(a),!a.includes("agregado"))throw new Error("Error al agregar platillo al carrito")}catch(a){throw console.error("Error al agregar platillo:",a),s.error("Error al agregar platillo al carrito"),a}})(),s.success("Producto(s) agregado(s) al carrito"),d("/shoppingcar")}catch(e){console.error("Error al manejar el carrito:",e),s.error("Error al agregar al carrito")}};return q?r.jsx(se,{}):r.jsx("main",{className:"flex flex-col min-h-screen",children:r.jsxs("div",{className:"flex flex-col md:flex-row flex-grow",children:[r.jsx("section",{className:"w-full md:w-1/2 order-1 md:order-1 flex items-center justify-center",children:r.jsx("div",{className:"bg-zinc-800 p-8 items-center flex rounded-xl h-full relative overflow-hidden",children:r.jsx("img",{src:`https://labarbada.store/img/${t[0].imagen_platillo}`,className:"rounded-xl w-full h-full object-cover",alt:"Producto"})})}),r.jsxs("section",{className:"w-full md:w-1/2 order-2 md:order-2 flex flex-col justify-center items-start px-8 md:px-16 lg:px-24",children:[r.jsx("h1",{className:"text-5xl mt-20 mb-6 font-bold text-white",children:"Detalle del producto"}),r.jsxs("div",{className:"mb-4 flex items-baseline space-x-2",children:[r.jsxs("div",{className:"text-2xl font-bold text-white",children:[t[0].nombre_platillo," -"]}),r.jsxs("div",{className:"text-2xl text-red-600 font-bold",children:["$",V]})]}),r.jsx("h1",{className:"text-white mb-2",children:"Descripción"}),r.jsx("div",{className:"w-full h-0.5 bg-white mb-4"}),r.jsx("div",{className:"bg-zinc-800 rounded-xl w-full mb-6",children:r.jsx("p",{className:"p-4 text-white",children:t[0].descripcion_platillo})}),r.jsxs("div",{className:`flex w-full mb-6 ${g.includes("ninguno")||h.includes("Unica")?"space-x-0":"space-x-4"}`,children:[!g.includes("ninguno")&&r.jsxs("div",{className:`w-${h.includes("Unica")?"full":"1/2"} pr-2`,children:[r.jsx("h1",{className:"my-2 text-white",children:"Tamaño"}),r.jsx("div",{className:"flex flex-wrap gap-2",children:g.map((e,a)=>r.jsx(S,{text:e,onClick:()=>M({value:e,label:e})},a))})]}),!h.includes("Unica")&&r.jsxs("div",{className:`w-${g.includes("ninguno")?"full":"1/2"} pl-2`,children:[r.jsx("h1",{className:"my-2 text-white",children:"Tipo"}),r.jsx("div",{className:"flex flex-wrap gap-2",children:h.map((e,a)=>r.jsx(S,{text:e,onClick:()=>W({value:e,label:e})},a))})]})]}),r.jsxs("div",{className:"w-full mb-6",children:[r.jsx("h1",{className:"font-medium text-white mb-2",children:"Acompáñalo con"}),r.jsx(_,{options:L.map(e=>({value:e.id_platillo_recomendado,label:e.platillo_recomendado,precio:e.precio_platillo_recomendado,extraText:`Precio: ${e.precio_platillo_recomendado}, Tamaño: ${e.tamaño_platillo_recomendado}`})),placeholder:"Selecciona un acompañamiento",onChange:Y,value:w})]}),r.jsxs("div",{className:"w-full mb-6",children:[r.jsx("h1",{className:"font-medium text-white mb-2",children:"Guarniciones"}),r.jsx(_,{options:F.map(e=>({value:e.id_platillo_recomendado,label:e.platillo_recomendado,precio:e.precio_platillo_recomendado,extraText:`Precio: ${e.precio_platillo_recomendado}, Tamaño: ${e.tamaño_platillo_recomendado}`})),placeholder:"Selecciona una guarnición",onChange:X,value:f})]}),r.jsxs("div",{className:"my-2 flex items-center space-x-4",children:[r.jsx("h1",{className:"text-white",children:"Cantidad"}),r.jsx(ne,{count:p,setCount:K})]}),r.jsxs("div",{className:"flex w-full mt-6",children:[r.jsx("div",{className:"w-1/2 pr-2",children:r.jsx(P,{icon:"mdi:bell",color:"bg-red-600",width:"w-2/3",hovColor:"hover:bg-red-700",textHover:"",text:"Ordenar ahora",click:Z})}),r.jsx("div",{className:"w-1/2 pl-2",children:r.jsx(P,{icon:"ic:round-shopping-cart",color:"bg-yellow-400",hovColor:"hover:bg-yellow-500",textHover:"",width:"w-2/3",text:"Agregar carrito",click:ee})})]})]})]})})}export{ge as default};
